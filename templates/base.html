<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Meal Planner{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen font-sans">

    {% block header %}{% endblock %}

    {% block content %}{% endblock %}

    {% block scripts %}
    <script>
        document.querySelectorAll(".dropdown-toggle").forEach(button => {
            button.addEventListener("click", () => {
                const id = button.getAttribute("data-menu-id");
                document.querySelectorAll(".dropdown-menu").forEach(menu => {
                    if (menu.id === "menu-" + id) {
                        menu.classList.toggle("hidden");
                    } else {
                        menu.classList.add("hidden");
                    }
                });
            });
        });

        document.addEventListener("click", (e) => {
            if (!e.target.closest(".dropdown-toggle") && !e.target.closest(".dropdown-menu")) {
                document.querySelectorAll(".dropdown-menu").forEach(menu => menu.classList.add("hidden"));
            }
        });

        document.querySelectorAll(".markdone-action").forEach(button => {
            button.addEventListener("click", () => {
                const id = button.getAttribute("data-meal-id");
                fetch(`/done/${id}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" }
                }).then(res => res.json())
                 .then(data => {
                     if (data.success) {
                         button.closest(".bg-gray-800").remove();
                     } else {
                         alert("Failed to mark as done.");
                     }
                 });
            });
        });

        document.querySelectorAll(".remove-action").forEach(button => {
            button.addEventListener("click", () => {
                const id = button.getAttribute("data-meal-id");
                fetch(`/remove/${id}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" }
                }).then(res => res.json())
                 .then(data => {
                     if (data.success) {
                         button.closest(".bg-gray-800").remove();
                     } else {
                         alert("Failed to remove meal.");
                     }
                 });
            });
        });

        document.querySelectorAll(".readd-action").forEach(button => {
            button.addEventListener("click", () => {
                const id = button.getAttribute("data-meal-id");
                fetch(`/readd/${id}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" }
                }).then(res => res.json())
                .then(data => {
                    if (data.success) {
                        button.closest(".bg-gray-800").remove();
                    } else {
                        alert("Failed to re-add meal.");
                    }
                });
            });
        });
    </script>
    {% endblock %}
</body>
</html>
