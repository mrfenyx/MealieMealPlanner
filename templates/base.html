<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Meal Planner{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen font-sans">
    <!-- Sidebar -->
    <div id="sidebar" class="fixed top-0 left-0 h-full w-64 bg-gray-800 shadow-lg transform -translate-x-full transition-transform duration-300 z-50">
        <div class="p-4 border-b border-gray-700">
            <h2 class="text-xl font-semibold flex items-center gap-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 12h14M12 5l7 7-7 7" />
                </svg>
                Menu
            </h2>
        </div>
        <nav class="p-4 flex flex-col gap-3">
            <a href="{{ url_for('index') }}" class="flex items-center gap-2 text-white hover:text-orange-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19,19V8H5V19H19M16,1H18V3H19A2,2 0 0,1 21,5V19A2,2 0 0,1 19,21H5C3.89,21 3,20.1 3,19V5C3,3.89 3.89,3 5,3H6V1H8V3H16V1M7,10H9V12H7V10M15,10H17V12H15V10M11,14H13V16H11V14M15,14H17V16H15V14Z" />
                </svg>
                Meal Plan
            </a>
            <a href="{{ url_for('view_done') }}" class="flex items-center gap-2 text-white hover:text-orange-400">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                Done Recipes
            </a>
        </nav>
    </div>

    <!-- Header -->
    <header class="bg-orange-500 px-4 py-3 sm:px-6 sm:py-4 flex justify-between items-center shadow-md">
        <div class="flex items-center gap-3">
            <!-- Hamburger Icon -->
            <button id="menuToggle" class="text-white focus:outline-none">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" />
                </svg>
            </button>
            <h1 class="text-xl sm:text-2xl font-bold">ðŸ¥— Weekly Meal Plan</h1>
        </div>
        {% block header_actions %}{% endblock %}
    </header>

    <main class="p-2 sm:p-6">
        {% block content %}{% endblock %}
    </main>

    <script>
        const sidebar = document.getElementById("sidebar");
        const toggle = document.getElementById("menuToggle");
        document.addEventListener("click", (e) => {
            if (toggle.contains(e.target)) {
                sidebar.classList.toggle("-translate-x-full");
            } else if (!sidebar.contains(e.target)) {
                sidebar.classList.add("-translate-x-full");
            }
        });

        document.querySelectorAll(".dropdown-toggle").forEach(button => {
            button.addEventListener("click", () => {
                const id = button.getAttribute("data-menu-id");
                document.querySelectorAll(".dropdown-menu").forEach(menu => {
                    if (menu.id === "menu-" + id) {
                        menu.classList.toggle("hidden");
                    } else {
                        menu.classList.add("hidden");
                    }
                });
            });
        });

        document.addEventListener("click", (e) => {
            if (!e.target.closest(".dropdown-toggle") && !e.target.closest(".dropdown-menu")) {
                document.querySelectorAll(".dropdown-menu").forEach(menu => menu.classList.add("hidden"));
            }
        });

        document.querySelectorAll(".markdone-action").forEach(button => {
            button.addEventListener("click", () => {
                const id = button.getAttribute("data-meal-id");
                fetch(`/done/${id}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" }
                }).then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            button.closest(".bg-gray-800").remove();
                        } else {
                            alert("Failed to mark as done.");
                        }
                    });
            });
        });

        document.querySelectorAll(".remove-action").forEach(button => {
            button.addEventListener("click", () => {
                const id = button.getAttribute("data-meal-id");
                fetch(`/remove/${id}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" }
                }).then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            button.closest(".bg-gray-800").remove();
                        } else {
                            alert("Failed to remove meal.");
                        }
                    });
            });
        });

        document.querySelectorAll(".readd-action").forEach(button => {
            button.addEventListener("click", () => {
                const id = button.getAttribute("data-meal-id");
                fetch(`/readd/${id}`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" }
                }).then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            button.closest(".bg-gray-800").remove();
                        } else {
                            alert("Failed to re-add meal.");
                        }
                    });
            });
        });
    </script>
</body>
</html>
