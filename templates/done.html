<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>✅ Done Recipes</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h1>✅ Done Recipes</h1>
    <a href="{{ url_for('index') }}">← Back to Planner</a>

    {% if items %}
        <div class="card-container">
            {% for item in items %}
                <div class="card">
                    {% if item.image_url %}
                        <img src="{{ item.image_url }}" alt="Image for {{ item.recipe.name }}">
                    {% else %}
                        <img src="https://via.placeholder.com/200x140?text=No+Image" alt="No image">
                    {% endif %}
                    <div class="card-content">
                        <div class="card-title">
                            {% if item.recipe_url %}
                                <a href="{{ item.recipe_url }}" target="_blank">{{ item.recipe.name }}</a>
                            {% else %}
                                {{ item.recipe.name }}
                            {% endif %}
                        </div>
                        <div class="card-description">
                            {{ item.recipe.description[:100] }}{% if item.recipe.description|length > 100 %}...{% endif %}
                        </div>
                        <button class="done-button" data-meal-id="{{ item.id }}">➕ Re-add</button>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>No completed meals.</p>
    {% endif %}

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".done-button").forEach(button => {
                button.addEventListener("click", () => {
                    const mealId = button.getAttribute("data-meal-id");
                    fetch(`/readd/${mealId}`, {
                        method: "POST",
                        headers: { "Content-Type": "application/json" }
                    }).then(response => response.json())
                    .then(data => {
                        if (data.success) {
                            const card = button.closest('.card');
                            card.remove();
                        } else {
                            alert("Failed to re-add meal: " + (data.message || "Unknown error"));
                        }
                    }).catch(error => {
                        alert("Error: " + error);
                    });
                });
            });
        });
        function readd(itemId, buttonElement) {
            fetch(`/readd/${itemId}`, {
                method: "POST",
                headers: { "Content-Type": "application/json" }
            }).then(response => response.json())
              .then(data => {
                  if (data.success) {
                      const card = buttonElement.closest('.card');
                      card.remove();
                  } else {
                      alert("Failed to re-add meal: " + (data.message || "Unknown error"));
                  }
              }).catch(error => {
                  alert("Error: " + error);
              });
        }
    </script>
</body>
</html>
