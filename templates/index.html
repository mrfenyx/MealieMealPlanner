<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Mealie Meal Plan</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen font-sans">
    <header class="bg-orange-500 px-6 py-4 flex justify-between items-center shadow-md">
        <h1 class="text-2xl font-bold">ðŸ¥— Weekly Meal Plan</h1>
        <a href="{{ url_for('view_done') }}" class="bg-white text-orange-500 font-semibold px-4 py-2 rounded hover:bg-gray-100">âœ… Show Done Recipes</a>
    </header>

    <main class="p-6">
        {% if items %}
            <div class="flex flex-wrap gap-6 justify-center">
                {% for item in items %}
                    <div class="bg-gray-800 rounded-lg shadow-md overflow-hidden w-full max-w-sm flex flex-col md:flex-row">
                        <img src="{{ item.image_url or 'https://via.placeholder.com/200x140?text=No+Image' }}" class="w-40 object-cover object-center flex-shrink-0" alt="Image for {{ item.recipe.name }}">
                        <div class="p-4 flex flex-col justify-between flex-grow">
                            <div>
                                <h2 class="text-lg font-bold mb-2">
                                    <a href="{{ item.recipe_url }}" class="text-orange-400 hover:underline" target="_blank">{{ item.recipe.name }}</a>
                                </h2>
                                <p class="text-sm text-gray-300">
                                    {{ item.recipe.description[:100] }}{% if item.recipe.description|length > 100 %}...{% endif %}
                                </p>
                            </div>
                            <button class="mt-4 bg-orange-500 text-white px-3 py-1 rounded hover:bg-orange-600 done-button" data-meal-id="{{ item.id }}">âœ… Done</button>
                        </div>
                    </div>
                {% endfor %}
            </div>
        {% else %}
            <p class="text-center text-gray-400 mt-8">No meals found for this date range.</p>
        {% endif %}
    </main>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            document.querySelectorAll(".done-button").forEach(button => {
                button.addEventListener("click", () => {
                    const mealId = button.getAttribute("data-meal-id");
                    fetch(`/done/${mealId}`, {
                        method: "POST",
                        headers: {
                            "Content-Type": "application/json"
                        }
                    }).then(response => response.json())
                      .then(data => {
                          if (data.success) {
                              const card = button.closest('.bg-gray-800');
                              card.remove();
                          } else {
                              alert("Failed to mark as done: " + (data.message || "Unknown error"));
                          }
                      }).catch(error => {
                          alert("Error: " + error);
                      });
                });
            });
        });
    </script>
</body>
</html>
